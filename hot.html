<html>

<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src='https://cdn.rawgit.com/MikeMcl/big.js/8759c0f1/big.min.js'></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<div id="output" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <br />
        <p>Response:</p>
        <pre class="model-code"><code id="model-code"></code></pre>
    </div>
</div>

<body>
    <h2>Hot Wallet:</h2>
    <p>Requires Nanode API key. A state block requires: Private Key, Proof of Work, Previous Hash, Representative Address, Resulting Balance, and Destination Address.</p>

    <form onsubmit="return false;">
        <h4>Generate Information:</h4>
        <label>Nanode API Key: <input type="text" id="userAPI" /></label><br />
        <label>Your Account: <input type="text" id="userAccount" /></label><br />
        <label>Destination: <input type="text" id="userDestination" /></label><br />
        <label>Amount: <input type="text" id="userAmount" /></label><br />
        <input type="submit" onclick="getInfo()" />
    </form>
    
    <form onsubmit="return false;">
        <h4>Send Transaction (returns transaction hash):</h4>
        <label>Nanode API Key: <input type="text" id="userAPI" /></label><br />
        <label>Your Block: <input type="text" id="userBlock" /></label><br />
        <input type="submit" onclick="sendBlock()" />
    </form>

    <script>
        async function getInfo() {
            var userAPI = document.getElementById('userAPI').value;
            var userAccount = document.getElementById('userAccount').value;
            var userDestination = document.getElementById('userDestination').value;
            var userAmount = document.getElementById('userAmount').value;
            var multNANO = Big('1000000000000000000000000000000'); // 10^30
            var divNANO = Big('0.000000000000000000000000000001'); // 10^-30
            var rpc = axios.create({
                baseURL: 'https://api.nanode.co',
                headers: {
                    Authorization: userAPI
                }
            })
            var info = await rpc.post('/', {
                action: 'account_info',
                account: userAccount,
                count: 1
            })
            var work = await rpc.post('/', {
                action: 'work_generate',
                hash: info.data.frontier
            })
            var rep = await rpc.post('/', {
                action: 'account_representative',
                account: userAccount
            })
            userBalance = Big(Big(info.data.balance).times(divNANO));
            userBalance = userBalance.minus(userAmount);
            userBalance = Big(userBalance.times(multNANO)).toFixed();
            document.getElementById("model-code").innerHTML = "Proof of Work:\n" + work.data.work + "\nPrevious Hash:\n" + info.data.frontier + "\nRepresentative:\n" + rep.data.representative + "\nResulting Balance:\n" + userBalance + "\nDestination Address:\n" + userDestination;
            modal.style.display = "block";
        }
        
        async function sendBlock() {
            var userAPI = document.getElementById('userAPI').value;
            var userBlock = document.getElementById('userBlock').value;
            var rpc = axios.create({
                baseURL: 'https://api.nanode.co',
                headers: {
                    Authorization: userAPI
                }
            })
            var hash = await rpc.post('/', {
                action: 'process',
                block: userBlock
            })
            document.getElementById("model-code").innerHTML = hash.data.hash;
            modal.style.display = "block";
        }


        var modal = document.getElementById('output');
        var span = document.getElementsByClassName("close")[0];
        span.onclick = function() {
            modal.style.display = "none";
        }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }


        document.getElementById("model-code").innerHTML = "";
        modal.style.display = "none";
    </script>
</body>

</html>
